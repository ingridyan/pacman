import pygame
import random
import math

# initialize pygame
from bulletclass import Bullet
from castBio import CastBio
from button import Button
from friends import Person


pygame.init()

# create the screen
screen = pygame.display.set_mode((800, 600))

# background
background = pygame.image.load('notebookbackground.png')
DEFAULT_IMAGE_SIZE = (800, 600)
background = pygame.transform.scale(background, DEFAULT_IMAGE_SIZE)

# title and icon (check flat icon, make sure icon is 32, 32 png)
pygame.display.set_caption("Bae Watch")
icon = pygame.image.load('camera.png')
pygame.display.set_icon(icon)

FriendsList = []

FriendsList.append(Person(screen, "ashlyn", random.randint(0, 730), random.randint(25, 150), 0.2, 30, True,
                          70, 60, "ashlyn walking png.png", False))

FriendsList.append(Person(screen, "alexis", random.randint(0, 730), random.randint(25, 150), 0.2, 30, True,
                          90, 153, "alexis walking png.png", False))

FriendsList.append(Person(screen, "lilia", random.randint(0, 730), random.randint(25, 150), 0.2, 30, True,
                          80, 140, "lilia png.png", False))

FriendsList.append(Person(screen, "ingrid", random.randint(0, 730), random.randint(25, 150), 0.2, 30, True,
                          65, 125, "ingrid walking png.png", False))

FriendsList.append(Person(screen, "landry", random.randint(0, 730), random.randint(25, 150), 0.4, 0.4, True,
                          70, 130, "landry walking png.png", True))



score = 0

goldbullet = Bullet(screen, 0, 300, 0.5, False, FriendsList[-1])

# score and title

font = pygame.font.Font('freesansbold.ttf', 32)
textX = 10
textY = 10

# title pictures
lan_man_title = pygame.image.load('attackoflanman.png')
DEFAULT_IMAGE_SIZE = (500, 500)
lan_man_title = (pygame.transform.scale(lan_man_title, DEFAULT_IMAGE_SIZE))


def show_titlepage(x, y):
    shown_title = font.render("Ingrid Yan", True, (0, 0, 0))
    screen.blit(shown_title, (x, y))


def show_score(x, y):
    # typecasting
    shown_score = font.render("Score: " + str(score), True, (0, 0, 0))
    screen.blit(shown_score, (x, y))


# load button images
start_img = pygame.image.load('start.png').convert_alpha()
cast_img = pygame.image.load('cast.png').convert_alpha()
playagain_img = pygame.image.load('playagain.png').convert_alpha()

# create  button instances
start_button = Button(100, 430, start_img, 0.6, screen)
playagain = Button(100, 430, playagain_img, 0.6, screen)
cast_button = Button(550, 430, cast_img, 0.6, screen)
start_button_for_cast = Button(300, 450, cast_img, 0.6, screen)
playagain_for_end = Button(550, 200, playagain_img, 0.6, screen)
# 1st title page
castPage = False
running = False
titlePageRun = True
endPage = False
while titlePageRun:
    screen.blit(background, (0, 0))
    show_titlepage(textX, textY)
    screen.blit(lan_man_title, (150, 50))
    if start_button.draw() == True:
        print("start clicked")
        running = True
        titlePageRun = False
    if cast_button.draw() == True:
        print("cast clicked")
        castPage = True
        titlePageRun = False
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            titlePageRun = False
    pygame.display.update()

while castPage:
    screen.fill((202, 228, 241))

    meetthecast = font.render("Meet the Cast", True, (0, 0, 0))
    screen.blit(meetthecast, (50, 0))

    myCast = CastBio(screen)
    myCast.castAll()

    if start_button_for_cast.draw() == True:
        print("start clicked")
        running = True
        castPage = False
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            castPage = False
    pygame.display.update()

# game loop, make sure window doesn't close down



while running:
    screen.fill((133, 186, 204))
    screen.blit(background, (0, 0))
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
        # if keystroke is pressed check whether its right or left
        if score == 2:
            running = False
            endPage = True
        if event.type == pygame.KEYDOWN:
            for eachPerson in FriendsList:
                eachPerson.respondKeyDownEvent(event)
            goldbullet.RespondKeyDownEvent(event)
        if event.type == pygame.KEYUP:
            for eachPerson in FriendsList:
                eachPerson.respondKeyUpEvent(event)

    for eachPerson in FriendsList:
        eachPerson.movePerson()
        eachPerson.drawPerson(goldbullet.getX(), goldbullet.getY())

    goldbullet.moveAndDrawBullet()

    show_score(textX, textY)
    pygame.display.update()


    while endPage:
        castfont = pygame.font.Font('freesansbold.ttf', 35)
        screen.blit(background, (0, 0))
        DEFAULT_IMAGE_SIZE = (450, 450)
        lan_man_title = (pygame.transform.scale(lan_man_title, DEFAULT_IMAGE_SIZE))
        screen.blit(lan_man_title, (50, 100))
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                endPage = False
        ingridbio = castfont.render("Good job", True, (0, 0, 0))
        screen.blit(ingridbio, (100, 50))
        if playagain_for_end.draw() == True:
            print("start clicked")
            score = 0
            running = True
            endPage = False
        pygame.display.update()

    pygame.display.update()


